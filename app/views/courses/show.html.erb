<% provide(:title, t("courses.new.title")) %>
<% provide(:button_text, t("courses.new.create")) %>
<div id="page-content" style="min-height: 1310px;">
  <ul class="breadcrumb breadcrumb-top">
    <li><%= t "courses.courses" %></li>
    <li><a href=""><%= t "courses.show.show" %></a></li>
  </ul>
  <div class="block full block-alt-noborder">
    <h3 class="sub-header text-center">
      <strong><%= @course.name %></strong>
      <%= link_to edit_course_path(@course), class: "pull-right" do %><i class="fa fa-pencil"></i><% end %>
    </h3>
    <div class="sub-header">
      <strong><%= t "courses.id" %> :</strong>
      <%= @course.id %>
    </div>
    <div class="sub-header">
      <strong><%= t "courses.description" %> :</strong>
      <%= @course.description %>
    </div>
    <div class="sub-header">
      <strong><%= t "courses.new.start_time" %> :</strong>
      <%= @course.start_time %>
    </div>
    <div class="sub-header">
      <strong><%= t "courses.new.end_time" %> :</strong>
      <%= @course.end_time %>
    </div>
    <div class="sub-header">
      <strong>Trainee :</strong>
      <%= @trainee %>
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Add new Trainer</button>
    </div>
    <div class="sub-header">
      <strong>Trainer :</strong>
      <%= @trainer %>
    </div>
    <div class="sub-header">
      <%= link_to "add user" ,edit_course_path(@course)%>
    </div>
  </div>
  <div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Adding Trainee to <%= @course.name %></h4>
        </div>
        <div class="modal-body">
          <%= form_for(UserCourse.new, method: :post, html: { class: "form-horizontal form-bordered form-control-borderless" }) do |f| %>
          <div class="form-group">
            <h1> Select trainer</h1>
            <%= f.select(:user_id, User.trainee.collect { |u| [u.name,u.id]}, {}, class: "form-control",id: "trainee-select") %>
          </div>
          <div class="modal-footer">
            <%= f.submit "Add" , class: "btn btn-primary" %>
          </div>
          <%end%>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  var userid = new Array;
  $('#trainee-select').multiSelect({
      selectableHeader: "<input type='text' class='search-input form-control' autocomplete='off' placeholder='try \"12\"'>",
      selectionHeader: "<input type='text' class='search-input form-control' autocomplete='off' placeholder='try \"4\"'>",
      afterInit: function(ms){
        var that = this,
            $selectableSearch = that.$selectableUl.prev(),
            $selectionSearch = that.$selectionUl.prev(),
            selectableSearchString = '#'+that.$container.attr('id')+' .ms-elem-selectable:not(.ms-selected)',
            selectionSearchString = '#'+that.$container.attr('id')+' .ms-elem-selection.ms-selected';

        that.qs1 = $selectableSearch.quicksearch(selectableSearchString)
        .on('keydown', function(e){
          if (e.which === 40){
            that.$selectableUl.focus();
            return false;
          }
        });

        that.qs2 = $selectionSearch.quicksearch(selectionSearchString)
        .on('keydown', function(e){
          if (e.which == 40){
            that.$selectionUl.focus();
            return false;
          }
        });
      },
      afterSelect: function(values){
        this.qs1.cache();
        this.qs2.cache();
        userid.push(values[0]);
      },
      afterDeselect: function(values){
        this.qs1.cache();
        this.qs2.cache();
        console.log(values);
        var index = userid.indexOf(values[0]);
        userid.splice(index,1);
      }
    });
  $('#trainer-select').multiSelect({
      selectableHeader: "<input type='text' class='search-input form-control' autocomplete='off' placeholder='try \"12\"'>",
      selectionHeader: "<input type='text' class='search-input form-control' autocomplete='off' placeholder='try \"4\"'>",
      afterInit: function(ms){
        var that = this,
            $selectableSearch = that.$selectableUl.prev(),
            $selectionSearch = that.$selectionUl.prev(),
            selectableSearchString = '#'+that.$container.attr('id')+' .ms-elem-selectable:not(.ms-selected)',
            selectionSearchString = '#'+that.$container.attr('id')+' .ms-elem-selection.ms-selected';

        that.qs1 = $selectableSearch.quicksearch(selectableSearchString)
        .on('keydown', function(e){
          if (e.which === 40){
            that.$selectableUl.focus();
            return false;
          }
        });

        that.qs2 = $selectionSearch.quicksearch(selectionSearchString)
        .on('keydown', function(e){
          if (e.which == 40){
            that.$selectionUl.focus();
            return false;
          }
        });
      },
      afterSelect: function(){
        this.qs1.cache();
        this.qs2.cache();
      },
      afterDeselect: function(){
        this.qs1.cache();
        this.qs2.cache();
      }
  });
</script>
